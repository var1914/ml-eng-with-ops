apiVersion: v1
kind: ConfigMap
metadata:
  name: crypto-ml-dashboards
  namespace: ml-monitoring
  labels:
    grafana_dashboard: "1"
  annotations:
    grafana_folder: "Crypto ML"
data:
  crypto-ml-overview.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Crypto ML Pipeline Overview",
        "tags": ["crypto", "ml", "overview"],
        "timezone": "browser",
        "refresh": "30s",
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Pipeline Health Score",
            "type": "stat",
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "avg(crypto_pipeline_health_score)",
                "legendFormat": "Overall Health",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "min": 0,
                "max": 100,
                "unit": "percent",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 70},
                    {"color": "green", "value": 90}
                  ]
                }
              }
            }
          },
          {
            "id": 2,
            "title": "Data Completeness by Symbol",
            "type": "bargauge",
            "gridPos": {"h": 8, "w": 9, "x": 6, "y": 0},
            "targets": [
              {
                "expr": "data_quality_completeness_ratio",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "min": 0,
                "max": 1,
                "unit": "percentunit",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 0.8},
                    {"color": "green", "value": 0.95}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "Feature Count by Symbol",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 9, "x": 15, "y": 0},
            "targets": [
              {
                "expr": "sum by (symbol) (crypto_feature_count_total)",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ]
          },
          {
            "id": 4,
            "title": "Model Training Success Rate",
            "type": "stat",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "rate(ml_pipeline_runs_total{pipeline_type=\"model_training\",status=\"success\"}[1h]) / rate(ml_pipeline_runs_total{pipeline_type=\"model_training\"}[1h]) * 100",
                "legendFormat": "Success Rate",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 80},
                    {"color": "green", "value": 95}
                  ]
                }
              }
            }
          },
          {
            "id": 5,
            "title": "Active Models by Stage",
            "type": "piechart",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "sum by (stage) (crypto_models_registry_count)",
                "legendFormat": "{{stage}}",
                "refId": "A"
              }
            ]
          }
        ],
        "templating": {
          "list": [
            {
              "name": "symbol",
              "type": "query",
              "query": "label_values(data_quality_completeness_ratio, symbol)",
              "refresh": 1,
              "includeAll": true,
              "allValue": ".*"
            }
          ]
        }
      }
    }
  data-quality-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Data Quality Monitoring",
        "tags": ["crypto", "data-quality"],
        "timezone": "browser",
        "refresh": "1m",
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Data Quality Score Over Time",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "crypto_data_quality_score",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "min": 0,
                "max": 100,
                "unit": "percent"
              }
            }
          },
          {
            "id": 2,
            "title": "Data Completeness Ratio",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
            "targets": [
              {
                "expr": "data_quality_completeness_ratio",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percentunit",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 0.8},
                    {"color": "green", "value": 0.95}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "Data Freshness (Hours)",
            "type": "stat",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "data_freshness_hours",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "h",
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 3},
                    {"color": "red", "value": 6}
                  ]
                }
              }
            },
            "alert": {
              "conditions": [
                {
                  "evaluator": {"params": [6], "type": "gt"},
                  "operator": {"type": "and"},
                  "query": {"params": ["A", "5m", "now"]},
                  "reducer": {"type": "last"},
                  "type": "query"
                }
              ],
              "executionErrorState": "alerting",
              "frequency": "1m",
              "handler": 1,
              "name": "Data Freshness Alert",
              "noDataState": "no_data",
              "notifications": []
            }
          },
          {
            "id": 4,
            "title": "Timestamp Gaps & Outliers",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "data_quality_timestamp_gaps",
                "legendFormat": "Gaps - {{symbol}}",
                "refId": "A"
              },
              {
                "expr": "data_quality_outliers_total",
                "legendFormat": "Outliers - {{symbol}}",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "short"
              }
            }
          }
        ]
      }
    }
  model-performance-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Model Performance & Training",
        "tags": ["crypto", "models"],
        "timezone": "browser",
        "refresh": "30s",
        "time": {
          "from": "now-12h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Model Accuracy (RMSE)",
            "type": "table",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "crypto_model_accuracy_score{metric_type=\"rmse\"}",
                "format": "table",
                "instant": true,
                "refId": "A"
              }
            ]
          },
          {
            "id": 2,
            "title": "Training Time Distribution",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
            "targets": [
              {
                "expr": "histogram_quantile(0.95, crypto_model_training_seconds_bucket)",
                "legendFormat": "95th percentile",
                "refId": "A"
              },
              {
                "expr": "histogram_quantile(0.50, crypto_model_training_seconds_bucket)",
                "legendFormat": "50th percentile",
                "refId": "B"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s"
              }
            }
          },
          {
            "id": 3,
            "title": "Model Promotions",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "increase(crypto_model_promotions_total[1h])",
                "legendFormat": "{{from_stage}} â†’ {{to_stage}}",
                "refId": "A"
              }
            ]
          },
          {
            "id": 4,
            "title": "Model Health Scores",
            "type": "bargauge",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "crypto_model_health_score",
                "legendFormat": "{{symbol}}_{{model_type}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "min": 0,
                "max": 100,
                "unit": "percent",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 70},
                    {"color": "green", "value": 90}
                  ]
                }
              }
            }
          }
        ]
      }
    }
  feature-engineering-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Feature Engineering Monitoring",
        "tags": ["crypto", "features"],
        "timezone": "browser",
        "refresh": "5m",
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Feature Count by Category",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "crypto_feature_count_total",
                "legendFormat": "{{symbol}}_{{feature_category}}",
                "refId": "A"
              }
            ]
          },
          {
            "id": 2,
            "title": "Feature Processing Time",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
            "targets": [
              {
                "expr": "rate(feature_engineering_processing_seconds_sum[5m])",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s"
              }
            }
          },
          {
            "id": 3,
            "title": "Feature Null Percentage",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "feature_engineering_null_percentage",
                "legendFormat": "{{symbol}}_{{feature_type}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 10},
                    {"color": "red", "value": 20}
                  ]
                }
              }
            }
          },
          {
            "id": 4,
            "title": "Total Features by Symbol",
            "type": "stat",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "sum by (symbol) (crypto_feature_count_total)",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ]
          }
        ]
      }
    }
  system-health-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "System Health & Infrastructure",
        "tags": ["crypto", "system"],
        "timezone": "browser",
        "refresh": "30s",
        "time": {
          "from": "now-6h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Pipeline Success Rate",
            "type": "stat",
            "gridPos": {"h": 8, "w": 8, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "rate(ml_pipeline_runs_total{status=\"success\"}[1h]) / rate(ml_pipeline_runs_total[1h]) * 100",
                "legendFormat": "Success Rate",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 80},
                    {"color": "green", "value": 95}
                  ]
                }
              }
            }
          },
          {
            "id": 2,
            "title": "Pipeline Execution Times",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 8, "x": 8, "y": 0},
            "targets": [
              {
                "expr": "histogram_quantile(0.95, feature_engineering_processing_seconds_bucket)",
                "legendFormat": "95th percentile - {{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "s"
              }
            }
          },
          {
            "id": 3,
            "title": "Pipeline Health Score",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 8, "x": 16, "y": 0},
            "targets": [
              {
                "expr": "ml_pipeline_health_score",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "min": 0,
                "max": 100,
                "unit": "percent"
              }
            }
          },
          {
            "id": 4,
            "title": "Pipeline Runs Over Time",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "increase(ml_pipeline_runs_total[1h])",
                "legendFormat": "{{pipeline_type}} - {{status}}",
                "refId": "A"
              }
            ]
          },
          {
            "id": 5,
            "title": "Pipeline Status Distribution",
            "type": "piechart",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "sum by (status) (increase(ml_pipeline_runs_total[24h]))",
                "legendFormat": "{{status}}",
                "refId": "A"
              }
            ]
          }
        ]
      }
    }
  validation-monitoring-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "Data Validation Monitoring",
        "tags": ["crypto", "validation"],
        "timezone": "browser",
        "refresh": "1m",
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Validation Pass Rate",
            "type": "bargauge",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
            "targets": [
              {
                "expr": "data_validation_pass_rate",
                "legendFormat": "{{dataset_name}} - {{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "min": 0,
                "max": 1,
                "unit": "percentunit",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 0.7},
                    {"color": "green", "value": 0.9}
                  ]
                }
              }
            }
          },
          {
            "id": 2,
            "title": "Critical Validation Failures",
            "type": "stat",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
            "targets": [
              {
                "expr": "sum by (symbol) (data_validation_critical_failures)",
                "legendFormat": "{{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "red", "value": 1}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "Validation Warnings Over Time",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
            "targets": [
              {
                "expr": "data_validation_warnings",
                "legendFormat": "{{dataset_name}} - {{symbol}}",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": 0},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 10}
                  ]
                }
              }
            }
          },
          {
            "id": 4,
            "title": "Validation Runs (Success vs Failed)",
            "type": "timeseries",
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
            "targets": [
              {
                "expr": "increase(data_validation_runs_total[1h])",
                "legendFormat": "{{dataset_name}} - {{status}}",
                "refId": "A"
              }
            ]
          }
        ]
      }
    }